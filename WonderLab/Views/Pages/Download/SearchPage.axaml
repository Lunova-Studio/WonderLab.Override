<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
			 xmlns:wc="using:WonderLab.Controls"
			 xmlns:wce="using:WonderLab.Classes.Enums"
			 xmlns:wa="using:WonderLab.Media.Attachments"
			 xmlns:mbe="using:MinecraftLaunch.Base.Enums"
			 xmlns:wem="using:WonderLab.Extensions.Markup"
			 xmlns:ail="using:AsyncImageLoader"
			 xmlns:mi="using:Material.Icons.Avalonia"
             x:Class="WonderLab.SearchPage">
	<UserControl.Resources>
		<DataTemplate x:Key="CategoryTagTemplate">
			<wc:Tag Text="{Binding}"/>
		</DataTemplate>

		<ItemsPanelTemplate x:Key="ItemsControlPanel">
			<StackPanel Spacing="4" Orientation="Horizontal"/>
		</ItemsPanelTemplate>
		
		<RecyclingElementFactory SelectTemplateKey="OnSelectTemplateKey"
								 x:Key="ResourceTemplateSelector">
			<RecyclingElementFactory.Templates>
				<DataTemplate x:Key="Minecraft">
					<wc:NavigationTile Classes="content"
									   IsEnableAnimation="False"
									   Title="{Binding Id}"
									   CommandParameter="{Binding}"
									   Command="{Binding $parent[ItemsRepeater].DataContext.JumpToResourcePageCommand}">
						<wc:NavigationTile.Icon>
							<Border Width="40"
									Height="40"
									CornerRadius="{StaticResource WeakCornerRadius}">
								<Border.Background>
									<ImageBrush Source="{Binding, Converter={StaticResource MinecraftIconConverter}}"/>
								</Border.Background>
							</Border>
						</wc:NavigationTile.Icon>

						<wc:NavigationTile.Description>
							<Grid Margin="0 2 0 0"
								  ColumnDefinitions="auto *">
								<wc:Tag Text="{Binding Type}"/>
								
								<TextBlock Margin="8 0 0 0"
										   Classes="Caption"
										   VerticalAlignment="Center"
										   TextTrimming="CharacterEllipsis"
										   Text="{Binding ReleaseTime}"
										   Grid.Column="1"/>
							</Grid>
						</wc:NavigationTile.Description>
					</wc:NavigationTile>
				</DataTemplate>

				<DataTemplate x:Key="ModrinthResource">
					<wc:NavigationTile Padding="4 2"
									   Classes="content"
									   IsEnableAnimation="False"
									   Title="{Binding Name}"
									   CommandParameter="{Binding}"
									   Command="{Binding $parent[ItemsRepeater].DataContext.JumpToResourcePageCommand}">
						<wc:NavigationTile.Icon>
							<Border Width="50"
									Height="50"
									CornerRadius="{StaticResource WeakCornerRadius}">
								<Border.Background>
									<ImageBrush ail:ImageBrushLoader.Source="{Binding IconUrl}"/>
								</Border.Background>
							</Border>
						</wc:NavigationTile.Icon>

						<wc:NavigationTile.Description>
							<Grid Margin="0 2 0 0"
								  RowDefinitions="* *"
								  ColumnDefinitions="auto *"
								  Grid.IsSharedSizeScope="True">
								<ItemsControl ItemsSource="{Binding Categories}"
											  ItemsPanel="{StaticResource ItemsControlPanel}"
											  ItemTemplate="{StaticResource CategoryTagTemplate}"
											  Grid.Row="0"
											  Grid.Column="0"/>

								<TextBlock Margin="8 0 0 0"
										   Classes="Caption"
										   VerticalAlignment="Center"
										   TextTrimming="CharacterEllipsis"
										   Text="{Binding Summary, Converter={StaticResource MultilineStringConverter}}"
										   Grid.Row="0"
										   Grid.Column="1"/>

								<Grid Margin="0 4 0 0"
									  Grid.Row="1"
									  Grid.Column="0"
									  Grid.ColumnSpan="2">
									<Grid.ColumnDefinitions>
										<ColumnDefinition SharedSizeGroup="Version" Width="auto"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition SharedSizeGroup="Download" Width="auto"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition SharedSizeGroup="Source" Width="auto"/>
										<ColumnDefinition Width="*"/>
									</Grid.ColumnDefinitions>

									<mi:MaterialIcon Kind="Minecraft"
													 VerticalAlignment="Center"
													 Grid.Column="0"/>
									
									<TextBlock Classes="Caption"
											   Margin="8 0 0 0"
											   VerticalAlignment="Center"
											   HorizontalAlignment="Left"
											   Text="{Binding MinecraftVersions, Converter={StaticResource MinecraftVersionsConverter}}"
											   Grid.Column="1"/>

									<mi:MaterialIcon Kind="Download"
													 VerticalAlignment="Center"
													 Grid.Column="2"/>
									
									<TextBlock Classes="Caption"
											   Margin="8 0 0 0"
											   VerticalAlignment="Center"
											   HorizontalAlignment="Left"
											   Text="{Binding DownloadCount}"
											   Grid.Column="3"/>

									<mi:MaterialIcon Kind="Web"
													 VerticalAlignment="Center"
													 Grid.Column="4"/>

									<TextBlock Text="Modrinth"
											   Margin="8 0 0 0"
											   Classes="Caption"
											   VerticalAlignment="Center"
											   HorizontalAlignment="Left"
											   Grid.Column="5"/>
								</Grid>
							</Grid>
						</wc:NavigationTile.Description>
					</wc:NavigationTile>
				</DataTemplate>

				<DataTemplate x:Key="CurseforgeResource">
					<wc:NavigationTile Padding="4 2"
									   Classes="content"
									   IsEnableAnimation="False"
									   Title="{Binding Name}"
									   CommandParameter="{Binding}"
									   Command="{Binding $parent[ItemsRepeater].DataContext.JumpToResourcePageCommand}">
						<wc:NavigationTile.Icon>
							<Border Width="50"
									Height="50"
									CornerRadius="{StaticResource WeakCornerRadius}">
								<Border.Background>
									<ImageBrush Stretch="Fill"
												ail:ImageBrushLoader.Source="{Binding IconUrl}"/>
								</Border.Background>
							</Border>
						</wc:NavigationTile.Icon>

						<wc:NavigationTile.Description>
							<Grid Margin="0 2 0 0"
								  RowDefinitions="* *"
								  ColumnDefinitions="auto *"
								  Grid.IsSharedSizeScope="True">
								<ItemsControl ItemsSource="{Binding Categories}"
											  ItemsPanel="{StaticResource ItemsControlPanel}"
											  ItemTemplate="{StaticResource CategoryTagTemplate}"
											  Grid.Row="0"
											  Grid.Column="0"/>

								<TextBlock Margin="8 0 0 0"
										   Classes="Caption"
										   VerticalAlignment="Center"
										   TextTrimming="CharacterEllipsis"
										   Text="{Binding Summary, Converter={StaticResource MultilineStringConverter}}"
										   Grid.Row="0"
										   Grid.Column="1"/>

								<Grid Margin="0 4 0 0"
									  Grid.Row="1"
									  Grid.Column="0"
									  Grid.ColumnSpan="2">
									<Grid.ColumnDefinitions>
										<ColumnDefinition SharedSizeGroup="Version" Width="auto"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition SharedSizeGroup="Download" Width="auto"/>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition SharedSizeGroup="Source" Width="auto"/>
										<ColumnDefinition Width="*"/>
									</Grid.ColumnDefinitions>

									<mi:MaterialIcon Kind="Minecraft"
													 VerticalAlignment="Center"
													 Grid.Column="0"/>

									<TextBlock Classes="Caption"
											   Margin="8 0 0 0"
											   VerticalAlignment="Center"
											   HorizontalAlignment="Left"
											   Text="{Binding MinecraftVersions, Converter={StaticResource MinecraftVersionsConverter}}"
											   Grid.Column="1"/>

									<mi:MaterialIcon Kind="Download"
													 VerticalAlignment="Center"
													 Grid.Column="2"/>

									<TextBlock Classes="Caption"
											   Margin="8 0 0 0"
											   VerticalAlignment="Center"
											   HorizontalAlignment="Left"
											   Text="{Binding DownloadCount}"
											   Grid.Column="3"/>

									<mi:MaterialIcon Kind="Web"
													 VerticalAlignment="Center"
													 Grid.Column="4"/>

									<TextBlock Text="Curseforge"
											   Margin="8 0 0 0"
											   Classes="Caption"
											   VerticalAlignment="Center"
											   HorizontalAlignment="Left"
											   Grid.Column="5"/>
								</Grid>
							</Grid>
						</wc:NavigationTile.Description>
					</wc:NavigationTile>
				</DataTemplate>
			</RecyclingElementFactory.Templates>
		</RecyclingElementFactory>
	</UserControl.Resources>

	<Interaction.Behaviors>
		<EventTriggerBehavior EventName="Loaded">
			<InvokeCommandAction Command="{Binding LoadedCommand}"/>
		</EventTriggerBehavior>
	</Interaction.Behaviors>
	
	<Grid RowSpacing="16"
		  RowDefinitions="auto, *">
		<WrapPanel LineSpacing="16"
				   ItemSpacing="16"
				   Orientation="Horizontal">
			<Button Width="100"
					Classes="primary"
					Content="搜素"
					Command="{Binding SearchCommand}"/>
			
			<!--Type-->
			<Grid ColumnSpacing="8"
				  ColumnDefinitions="auto auto *">
				<mi:MaterialIcon FontSize="16"
								 Kind="ImageFilterNone"
								 VerticalAlignment="Center"
								 Foreground="{DynamicResource OnBackgroundBrush}"
								 Grid.Column="0"/>
				
				<TextBlock Classes="Body"
						   Text="资源类型"
						   VerticalAlignment="Center"
						   Foreground="{DynamicResource OnBackgroundBrush}"
						   Grid.Column="1"/>
				
				<ComboBox MinWidth="100"
						  CornerRadius="6"
						  SelectedItem="{Binding SearchType, Mode=TwoWay}"
						  Background="{DynamicResource TextBoxBackgroundBrush}"
						  ItemsSource="{wem:EnumBinding {x:Type wce:SearchType}}"
						  Grid.Column="2"/>
			</Grid>

			<!--Minecraft type-->
			<Grid ColumnSpacing="8"
				  ColumnDefinitions="auto auto *"
				  IsVisible="{Binding IsCommunityResourcesFilterVisible, Converter={StaticResource BoolReverseConverter}}">
				<mi:MaterialIcon FontSize="16"
								 Kind="FilterOutline"
								 VerticalAlignment="Center"
								 Foreground="{DynamicResource OnBackgroundBrush}"
								 Grid.Column="0"/>

				<TextBlock Classes="Body"
						   Text="发布类型"
						   VerticalAlignment="Center"
						   Foreground="{DynamicResource OnBackgroundBrush}"
						   Grid.Column="1"/>

				<ComboBox MinWidth="100"
						  CornerRadius="6"
						  Background="{DynamicResource TextBoxBackgroundBrush}"
						  SelectedItem="{Binding MinecraftVersionType, Mode=TwoWay}"
						  ItemsSource="{wem:EnumBinding {x:Type mbe:MinecraftVersionType}}"
						  Grid.Column="2"/>
			</Grid>

			<!--Community resources-->
			<Grid ColumnSpacing="8"
				  ColumnDefinitions="auto auto *"
				  IsVisible="{Binding IsCommunityResourcesFilterVisible}">
				<mi:MaterialIcon FontSize="16"
								 Kind="ViewGridOutline"
								 VerticalAlignment="Center"
								 Foreground="{DynamicResource OnBackgroundBrush}"
								 Grid.Column="0"/>
				
				<TextBlock Classes="Body"
						   Text="资源分类"
						   VerticalAlignment="Center"
						   Foreground="{DynamicResource OnBackgroundBrush}"
						   Grid.Column="1"/>


				<ComboBox MinWidth="100"
						  CornerRadius="6"
						  ItemsSource="{Binding Categories}"
						  SelectedItem="{Binding Category, Mode=TwoWay}"
						  Background="{DynamicResource TextBoxBackgroundBrush}"
						  Grid.Column="2"/>
			</Grid>

			<Grid ColumnSpacing="8"
				  ColumnDefinitions="auto auto *"
				  IsVisible="{Binding IsCommunityResourcesFilterVisible}">
				<mi:MaterialIcon FontSize="16"
								 Kind="AnimationOutline"
								 VerticalAlignment="Center"
								 Foreground="{DynamicResource OnBackgroundBrush}"
								 Grid.Column="0"/>
				
				<TextBlock Classes="Body"
						   Text="搜索源"
						   VerticalAlignment="Center"
						   Foreground="{DynamicResource OnBackgroundBrush}"
						   Grid.Column="1"/>

				<ComboBox MinWidth="100"
						  CornerRadius="6"
						  SelectedItem="{Binding SearchSource, Mode=TwoWay}"
						  Background="{DynamicResource TextBoxBackgroundBrush}"
						  ItemsSource="{wem:EnumBinding {x:Type wce:SearchSourceType}}"
						  Grid.Column="2"/>
			</Grid>
		</WrapPanel>

		<wc:ProgressRing Width="50"
						 Height="50"
						 Background="Transparent"
						 VerticalAlignment="Center"
						 HorizontalAlignment="Center"
						 IsVisible="{Binding IsLoading}"
						 IsIndeterminate="{Binding IsLoading}"
						 Grid.Row="1"/>
		
		<ScrollViewer Grid.Row="1">
			<ItemsRepeater Margin="0 0 16 0"
						   ItemsSource="{Binding Resources}"
						   ItemTemplate="{StaticResource ResourceTemplateSelector}"
						   wa:ItemsRepeaterExtensions.AnimatedScroll="True">
				<ItemsRepeater.Layout>
					<StackLayout Spacing="8"/>
				</ItemsRepeater.Layout>
			</ItemsRepeater>
		</ScrollViewer>
	</Grid>
</UserControl>